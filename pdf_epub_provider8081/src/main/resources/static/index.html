<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <link rel="icon" href="./favicon.ico" type="image/x-icon"/>
    <title>PDF_To_EPUB</title>
    <link rel="stylesheet" href="./styles/sty.css">
    <link rel="stylesheet" href="./styles/style.css">
    <link rel="stylesheet" href="./styles/b11.css">
    <link rel="stylesheet" href="./styles/b12.css">
    <link rel="stylesheet" href="//apps.bdimg.com/libs/jqueryui/1.10.4/css/jquery-ui.min.css">
    <script src="//apps.bdimg.com/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
    <script>
        var fileLength = 0, filePath;
        var time1, time2, j = 0;

        function upLoad() {

            let formData = new FormData();
            formData.append('username', 'Rui');
            //console.log(pdfFile);console.log(username);

            if (fileLength == 1) {
                formData.append('pdfFile', $('#pdfFile')[0].files[0]);
                $.ajax({
                    url: "http://localhost:8081/PdfToEpub/upload/one",
                    type: "post",
                    data: formData,
                    header: "Access-Control-Allow-Origin",
                    contentType: false, //ÂøÖÈ°ª
                    processData: false, //ÂøÖÈ°ª
                    success:(function (returnMsg) {
                        //console.log(returnMsg);
                        filePath = returnMsg;
                        progressbar.progressbar("value", 99);
                    }),
                    error:(function (returnMsg) {
                        console.log("‰∏ä‰º†Â§±Ë¥•" + returnMsg);
                        fileName.innerHTML = "‰∏ä‰º†Â§±Ë¥•ÔºåËØ∑ÈáçÊñ∞ÈÄâÊã©ËΩ¨Êç¢Êñá‰ª∂";
                        document.getElementById("upload").removeAttribute('hidden');
                        $('#progressbar').attr('hidden', 'hidden');
                    })
                });
            } else if (fileLength > 1) {
                for (let i = 0; i < fileLength; i++) {
                    formData.append('uploadFiles', $('#pdfFile')[0].files[i]);
                    //console.log($('#pdfFile')[0].files[i]);
                }
                $.ajax({
                    url: "http://localhost:8081/PdfToEpub/upload/many",
                    type: "post",
                    data: formData,
                    header: "Access-Control-Allow-Origin",
                    contentType: false, //ÂøÖÈ°ª
                    processData: false, //ÂøÖÈ°ª
                    success:(function (returnMsg) {
                        //console.log(returnMsg);
                        filePath = returnMsg.split("\n");
                        //console.log(filePath);
                        progressbar.progressbar("value", 99);
                    }),
                    error:(function (returnMsg) {
                        console.log("‰∏ä‰º†Â§±Ë¥•" + returnMsg);
                        fileName.innerHTML = "‰∏ä‰º†Â§±Ë¥•ÔºåËØ∑ÈáçÊñ∞ÈÄâÊã©ËΩ¨Êç¢Êñá‰ª∂";
                        document.getElementById("upload").removeAttribute('hidden');
                        $('#progressbar').attr('hidden', 'hidden');
                    }),
                });
            } else {
                fileName.innerHTML = "ËØ∑ÈÄâÊã©ËΩ¨Êç¢Êñá‰ª∂";
                return;
            }

            setTimeout(function () {
                $('#upload').attr('hidden', 'hidden');
            },4000);
            document.getElementById("progressbar").removeAttribute('hidden');

            //ÈáçÁΩÆfileÁöÑouterHTMLÔºåÁ°Æ‰øùinput‰∏≠Ê≤°ÊúâÊñá‰ª∂Â≠òÂú®ÔºåÂÜçÂºÄÂßã‰∏ã‰∏ÄÊ¨°Êñá‰ª∂ËΩ¨Êç¢„ÄÇ
            var file = document.getElementById('pdfFile');
            file.outerHTML = file.outerHTML;

            //ËøõÂ∫¶Êù°
            var progressbar = $("#progressbar");

            progressbar.progressbar({
                value: false,
                change: function () {
                    //progressLabel.text( progressbar.progressbar( "value" ) + "%" );
                    fileName.innerHTML = "ËΩ¨Êç¢‰∏≠Loading......" + progressbar.progressbar("value") + "%";
                },
                complete: function () {
                    setTimeout(function () {
                        //progressLabel.text( "ÂÆåÊàêÔºÅ" );
                        $('#progressbar').attr('hidden', 'hidden');
                        fileName.innerHTML = "ËΩ¨Êç¢ÂÆåÊàê";
                        setTimeout(()=> document.getElementById("download").removeAttribute('hidden'),1000);
                    }, 1000);
                }
            });

            function progress() {
                var val = progressbar.progressbar("value") || 0;

                progressbar.progressbar("value", val + 1);

                if (val < 99) {
                    time2 = setTimeout(progress, 500);
                } else {
                    clearTimeout(time2);
                }
            }

            progress();
        }

        function downLoad() {

            if (fileLength > 1) {
                // ËØ∑Ê±ÇÂú∞ÂùÄ
                var url = "http://localhost:8081/PdfToEpub/download/one";
                // ÂàÜË£ÖformË°®Âçï
                var form = $("<form></form>").attr("action", url).attr("method", "post");
                // Â∞ÅË£ÖÂèÇÊï∞
                form.append($("<input></input>").attr("type", "hidden").attr("name", "username").attr("value", "Rui"));
                form.append($("<input></input>").attr("type", "hidden").attr("name", "path").attr("value", filePath[j++]));
                // Êèê‰∫§
                form.appendTo('body').submit().remove();
            } else if (fileLength == 1) {
                var url = "http://localhost:8081/PdfToEpub/download/one";
                var form = $("<form></form>").attr("action", url).attr("method", "post");
                form.append($("<input></input>").attr("type", "hidden").attr("name", "username").attr("value", "Rui"));
                form.append($("<input></input>").attr("type", "hidden").attr("name", "path").attr("value", filePath));
                form.appendTo('body').submit().remove();
                j++;
            }

            if (j < fileLength) {
                time1 = setInterval("downLoad()", 1000);
            } else {
                clearInterval(time1);
                j = 0;
                fileLength = 0;
            }

            setTimeout(function () {
                $('#download').attr('hidden', 'hidden');
                document.getElementById("upload").removeAttribute('hidden');
                fileName.innerHTML = "ÈÄâÊã©Êñá‰ª∂";
            },4000);
        }
    </script>
</head>

<body>
<section class="content" role="document">
    <main class="main">
        <section class="hero">
            <div class="hero-content">
                <h1 class="hero-title">PDF TO EPUB</h1>
                <p class="hero-description">We make great pdf-to-epub converter</p>
                <a class="hero-button" href="#who">Start the conversion</a>
            </div>
            <div class="hero-illustrations">
                <object type="image/svg+xml" data="images/illustrations/webpage.svg" class="illustration-webpage">
                    Webpage
                </object>
                <object type="image/svg+xml" data="images/illustrations/team.svg" class="illustration-team">
                    Team
                </object>
                <object type="image/svg+xml" data="images/illustrations/pen.svg" class="illustration-pen">
                    Pen
                </object>
            </div>
        </section>

        <div id="progressbar" style="height: 10px;" hidden></div>

        <section id="who" class="contact">
            <div class="contact-wrapper">
                <div class="contact-content" style="text-align: left">
                    <h3 class="contact-title" style="margin-left: 100px; margin-bottom: 10px;">üëá</h3>
                    <label class="action-label" for="pdfFile">
                        <h3 id="fileName" class="contact-title">ÁÇπÂáªÊ≠§Â§ÑÈÄâÊã©Êñá‰ª∂üìÑ</h3>
                    </label>
                    <input type="file" id="pdfFile" name="pdfFile" class="file-input"
                           onchange="fileLength = this.files.length;
                             var fileName = document.getElementById('fileName');
                             if (fileLength == 1) {
                                 fileName.innerText=this.files[0].name;
                             }else if (fileLength > 1) {
                                 fileName.innerHTML='';
                                 for(let i = 0; i < this.files.length; i++) {
                                     if (i!=fileLength-1) fileName.innerHTML+=this.files[i].name+'<br>';
                                     else fileName.innerHTML+=this.files[i].name;
                                 }
                             }"
                           multiple required hidden>
                    <button class="button" id="upload" type="submit" onclick="upLoad()">
                        <div class="inner">
                            <div class="zipper">
                                <div class="line"></div>
                                <div class="gradient"></div>
                            </div>
                            <span>‰∏ä‰º†Êñá‰ª∂</span>
                            <svg viewBox="0 0 20 16">
                                <polyline points="3 8.75 7.75 13.5 17 2.5"></polyline>
                            </svg>
                        </div>
                    </button>
                    <button class="button" id="download" type="submit" onclick="downLoad()" hidden>
                        <div class="inner">
                            <div class="zipper">
                                <div class="line"></div>
                                <div class="gradient"></div>
                            </div>
                            <span>‰∏ãËΩΩÊñá‰ª∂</span>
                            <svg viewBox="0 0 20 16">
                                <polyline points="3 8.75 7.75 13.5 17 2.5"></polyline>
                            </svg>
                        </div>
                    </button>
                    <script>
                        document.querySelectorAll('.button').forEach(button => button.addEventListener('click', e => {
                            if (!button.classList.contains('compress') && fileLength > 0) {

                                button.classList.add('compress');

                                setTimeout(() => button.classList.remove('compress'), 4000);

                            }
                            e.preventDefault();
                        }));
                    </script>
                </div>
            </div>
            <div class="footer-illustrations">
                <object type="image/svg+xml" data="images/illustrations/balloon.svg" class="illustration-balloon">
                    Balloon
                </object>
            </div>
        </section>
    </main>
</section>

<script async src="https://hosted.okayanalytics.com/tracker.js?tid=OA-LMAM3Y07"></script>
<script>
    $('a[href*="#"]:not([href="#"])').click(function () {
        if (location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '')
            || location.hostname == this.hostname) {

            history.pushState('', this.hash, "" + this.hash);

            var target = $(this.hash),

                target = target.length ? target : $('[name=' + this.hash.slice(1) + ']');

            if (target.length) {
                $('html,body').animate({
                    scrollTop: target.offset().top,
                }, 400);
                return false;
            }
        }
    });

    var $window = $(window);
    var $elem = $("#who");

    function isScrolledIntoView($elem, $window) {
        var docViewTop = $window.scrollTop();
        var docViewBottom = docViewTop + $window.height();

        var elemTop = $elem.offset().top;
        var elemBottom = elemTop + $elem.height();

        return ((elemBottom <= docViewBottom) && (elemTop >= docViewTop));
    }

    $(document).on("scroll", function () {
        if (isScrolledIntoView($elem, $window)) {
            $elem.addClass("animate")
        }
    });
</script>


<!--<div class="main-container full-height bg-light-gray">
    <div class="main-content">
        <div class="message-line ocr-warning"></div>
        <div class="container">
            <div class="content-area">
                <div class="page-title text-center">
                    <h1>PDFÂà∞EPUBËΩ¨Êç¢Âô®</h1>
                    <h2>Âú®Á∫øËΩ¨Êç¢ÊÇ®ÁöÑpdfÊñá‰ª∂‰∏∫epubÊñá‰ª∂</h2>
                </div>
                <div id="progressbar" style="height: 10px;" hidden></div>
                <div class="converter-container">
                    <div class="converter-wrapper">
                        <div class="converter-tabs ">
                            <div class="ct-tab">ÊñáÊ°£ËΩ¨Êç¢Âô®</div>
                        </div>
                        <div class="converter d-xl-flex justify-content-xl-center align-content-xl-start flex-xl-wrap">
                            <div class="file-source-button-wrapper file-source-button-resizable">
                                <div class="file-source-button">
                                    <label class="action-label" style="width: 400px; text-align: center" for="pdfFile">
                                        <span id="fileName">ÈÄâÊã©Êñá‰ª∂</span>
                                    </label>
                                    <div class="file-source-nav">
                                        <input type="file" id="pdfFile" name="pdfFile" class="file-input"
                                               onchange="fileLength = this.files.length;
                                                             var fileName = document.getElementById('fileName');
                                                             if (fileLength == 1) {
                                                                 fileName.innerText=this.files[0].name;
                                                             }else if (fileLength > 1) {
                                                                 fileName.innerHTML='';
                                                                 for(let i = 0; i < this.files.length; i++) {
                                                                     if (i!=fileLength-1) fileName.innerHTML+=this.files[i].name+'„ÄÅ<br>';
                                                                     else fileName.innerHTML+=this.files[i].name;
                                                                 }
                                                             }"
                                               multiple required hidden>
                                        <button id="upload" type="submit" class="btn btn-xl btn-primary"
                                                onclick="upLoad()">
                                            ËΩ¨Êç¢
                                        </button>
                                        <button id="download" type="submit" class="btn btn-xl btn-primary"
                                                onclick="downLoad()" hidden>
                                            ‰∏ãËΩΩ
                                        </button>
                                    </div>
                                </div>
                                <div class="file-source-caption d-none d-md-block"><span class="security-icon"
                                                                                         data-placement="left"
                                                                                         title="ÊÇ®ÁöÑÊâÄÊúâÊï∞ÊçÆÂßãÁªàÂèóÂà∞‰øùÊä§Âπ∂Âú®ÊÇ®ÁöÑÊéåÊéß‰∏≠„ÄÇÂú®ÂÆâÂÖ®È°µÈù¢‰∏ä‰∫ÜËß£ÊúâÂÖ≥Êàë‰ª¨ÈááÂèñÁöÑÊäÄÊúØÊÄßÂíåÁªÑÁªáÊÄßÂÆâÂÖ®Êé™ÊñΩÁöÑÊõ¥Â§ö‰ø°ÊÅØ„ÄÇ"></span>
                                    <span>ÊîæÁΩÆÊñá‰ª∂Âú®ËøôÈáå„ÄÇ100 MB‰∏∫ÊúÄÂ§ßÊñá‰ª∂Â§ßÂ∞è„ÄÇÊÉ≥Ë¶Å‰∏ä‰º†Â§ö‰∏™Êñá‰ª∂ËØ∑Êåâ‰ΩèctrlÔºåÂÜçËøõË°åÈÄâÊã©„ÄÇ</span></div>
                            </div>
                            <div class="formats-wrapper" data-from-format="pdf" data-to-format="epub">
                                <div class="format-btn" data-toggle="dropdown" aria-haspopup="true"
                                     aria-expanded="false" id="selectFormatFrom"><b>pdf</b></div>
                                <span>Âà∞</span>
                                <div class="format-btn" data-toggle="dropdown" aria-haspopup="true"
                                     aria-expanded="false" id="selectFormatTo"><b>epub</b></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>-->


</body>
</html>